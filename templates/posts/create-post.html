{% extends "posts/base.html" %}
{% load static %}

{% block content %}

<section class="s-content">

    <div class="">
        <div class="column large-12">

            <form id="create-new-post-form" method="POST" class="row col-12 mx-auto">
                {% csrf_token %}

                <div class="form-group">
                    <label for="title">
                        Title
                    </label>
                    <input class="form-control" type="text" placeholder="Title of post" name="title" id="post__title">
                </div>

                <div class="form-group mt-5">
                    <div class="mb-3">
                        <label for="formFile" class="form-label">Image:</label>
                        <input class="form-control" type="file" id="post_image">
                      </div>
                </div>

                <div class="form-group mt-5">
                    <div class="mb-3">
                        <label for="content" class="form-label">Content</label>
                        <textarea class="form-control" id="post_content" rows="3" placeholder="Post content. . ."></textarea>
                      </div>
                </div>

                <button type="submit" class="btn btn-primary">Create Post</button>

            </form>

        </div>
    </div>

</section> 

{% endblock content %}


{% block inline_js %}

<script>
    const postForm = document.getElementById("create-new-post-form");
    const postTitle = document.getElementById("post__title");
    const postImage = document.getElementById("post_image");
    const postContent = document.getElementById("post_content");
    const csrfToken = document.getElementsByName("csrfmiddlewaretoken")[0];
    const url = "http://127.0.0.1:8080/v1/api/";

    var postData = {
        "title": "",
        "image": "",
        "content": "",
        "author": ""
    }

    postForm.addEventListener("submit", (e) => {

        e.preventDefault();
        
        postData.title = postTitle.value;
        postData.image = postImage.files[0].name;
        postData.content = postContent.value;
        postData.author = parseInt("{{ request.user.id }}");

        console.log(postData);
        console.log(csrfToken);
            
        axios({
            method: "POST",
            url: url,
            xstfCookieName: "csrftoken",
            xsrfHeaderName: "X-CSRFToken",
            data: JSON.stringify(postData),
            headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': 'csrftoken',
            'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(res => {
            console.log(res);
        }).catch(err => {
            console.log(err);
        })
    })

</script>

{% endblock inline_js %}